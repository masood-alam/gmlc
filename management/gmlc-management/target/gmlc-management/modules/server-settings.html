					<h3 style="margin: 0px;"><i class="icon-dashboard"></i> GMLC Server Settings</h3>
					<hr style="margin: 10 0px;"/>

					<button id="apply-server-settings" class="btn btn-small" onclick="applyServerSettings()"><i class="icon-save" style="color: #000000;"></i>  Apply Changes</button>
					
					<p>
						<br/>
					</p> 
					
					<div class="alert alert-error" id="login-settings-error" style="display:none;">
					  <button type="button" class="close">&times;</button>
					  Some Fields are not correctly filled out, please double check the settings below !
					</div>
					
 					<p>
					<span id="mss-settings">
					<ul class="nav nav-tabs" id="myTab">
  						<li class="active"><a href="#errormessages" data-toggle="tab">Error Messages</a></li>
  						<li><a href="#ss7settings" data-toggle="tab">SS7 settings</a></li>
  						<li><a href="#various" data-toggle="tab">Various</a></li>
					</ul>	
						
  				 	<div id="sbb-op-content" class="tab-content">
  				 	
						<div class="tab-pane active" id="errormessages" style="margin-left: 10px;">
							
							<div id="div-dialogtimeouterrmssg" class="control-group">
								<span class="input-prepend" data-toggle="tooltip" data-placement="bottom" title="if 3rd party application is taking longer than configured Dialog Timeout, this error message will be shown to user">
									<span class="add-on">Dialog timeout error message</span>
									<input id="dialogtimeouterrmssg" type="text" class="input-mini" style="width: 260px; margin-right: 12px; text-align: center;" value="0" />
								</span>
							</div>

							<div id="div-servererrmssg" class="control-group">
								<span class="input-prepend" data-toggle="tooltip" data-placement="bottom" title="if any error occurs in GMLC, this message will be shown to user">
									<span class="add-on">Server error message</span>
									<input id="servererrmssg" type="text" class="input-mini" style="width: 260px; margin-right: 12px; text-align: center;" value="0" />
								</span>
							</div>							

							<div id="div-serveroverloadedmessage" class="control-group">
								<span class="input-prepend" data-toggle="tooltip" data-placement="bottom" title="If GMLC is overloaded (too many concurrent dialogs), this message will be shown to user">
									<span class="add-on">Server overload message</span>
									<input id="serveroverloadedmessage" type="text" class="input-mini" style="width: 260px; margin-right: 12px; text-align: center;" value="0" />
								</span>
							</div>							
					  	</div>
                    
                        <div class="tab-pane" id="ss7settings">
                        	<h5 style="border-bottom: 1px solid #DDD;">Global Title Configuration</h5>
							
							
						                     	
                        	
                        	<div id="div-gmlcgt" class="control-group">
								<span class="input-prepend" data-toggle="tooltip" data-placement="bottom" title="GMLC Global Title">
									<span class="add-on">GMLC Global Title</span>
									<input id="gmlcgt" type="text" class="input-mini" style="width: 160px; margin-right: 12px; text-align: center;" value="0" />
								</span>
							</div>							
													
							
							<h5 style="border-bottom: 1px solid #DDD;">Sub System Number Configuration</h5>  
							
							<div id="div-gmlcssn" class="control-group">      
								<span class="input-prepend" data-toggle="tooltip" data-placement="bottom" title="GMLC subsystem number">
									<span class="add-on">GMLC subsystem number</span>
									<input id="gmlcssn" type="text" class="input-mini" style="width: 30px; margin-right: 12px; text-align: center;" value="0" />
								</span>	
							</div>

							<div id="div-hlrssn" class="control-group">
								<span class="input-prepend" data-toggle="tooltip" data-placement="bottom" title="HLR subsystem number">
									<span class="add-on">HLR subsystem number</span>
									<input id="hlrssn" type="text" class="input-mini" style="width: 30px; margin-right: 12px; text-align: center;" value="0" />
								</span>	
							</div>
							
							<div id="div-mscssn" class="control-group">
								<span class="input-prepend" data-toggle="tooltip" data-placement="bottom" title="MSC subsystem number">
									<span class="add-on">MSC subsystem number</span>
									<input id="mscssn" type="text" class="input-mini" style="width: 30px; margin-right: 12px; text-align: center;" value="0" />
								</span>
							</div>
							
							<h5 style="border-bottom: 1px solid #DDD;">SS7 Version Configuration</h5>     
							
							<div id="div-maxmapv" class="control-group">   						                		
								<span class="input-prepend" data-toggle="tooltip" data-placement="bottom" title="this is MAP version supported. if far end returns error indicating lower/highers version, GMLC will automatically create new message with lower/highers version of MAP message">
									<span class="add-on">MAP version supported</span>
									<input id="maxmapv" type="text" class="input-mini" style="width: 30px; margin-right: 12px; text-align: center;" value="0" />
								</span>							
							</div>
                        </div>
                        <div class="tab-pane" id="various">
                        	<h5 style="border-bottom: 1px solid #DDD;">Dialog Configuration</h5>
                        	
                        	<div id="div-dialogtimeout" class="control-group">
								<span class="input-prepend" data-toggle="tooltip" data-placement="bottom" title="3rd party application (HTTP or SIP) should revert back within configured Dialog Timeout value, else GMLC will send back error message configured for Dialog timeout. TCAP Dialog timeout (that is configurable from JSS7 management console) is responsible if no response from SS7 side. This timer must be less then TCAP Dialog timeout timer.">
									<span class="add-on">Dialog Timeout</span>
									<input id="dialogtimeout" type="text" class="input-mini" style="width: 120px; margin-right: 12px; text-align: center;" value="0" />
								</span>                        
							</div>

                        	<div id="div-maxactivitycount" class="control-group">
								<span class="input-prepend" data-toggle="tooltip" data-placement="bottom" title="If a count of TCAP dialogs exceeds of this value then GMLC will reject new incoming PULL requests from subscribers with the message from serveroverloadedmsg parameter.">
									<span class="add-on">Max activity count</span>
									<input id="maxactivitycount" type="text" class="input-mini" style="width: 120px; margin-right: 12px; text-align: center;" value="0" />
								</span>                        
							</div>

                        	
                        </div>                        					  	
					</div>	
					</span>					 
				</p>	
				<script type="text/javascript">
					$('#login-settings-error .close').on("click", function(e) {
					    $(this).parent().hide();
					});
				
					$(document).ready(function () {
						mbeanSearch="org.mobicents.gmlc:name=GmlcPropertiesManagement";
						
						jolokia.request(
								[
									{ type: "read", mbean: mbeanSearch },
								],
								{ success: [
									function(response) {
										$("#dialogtimeouterrmssg").val(response.value.DialogTimeoutErrorMessage);
										$("#dialogtimeout").val(response.value.DialogTimeout);
										$("#maxactivitycount").val(response.value.MaxActivityCount);
										$("#servererrmssg").val(response.value.ServerErrorMessage);
										$("#serveroverloadedmessage").val(response.value.ServerOverloadedMessage);
										$("#gmlcgt").val(response.value.GmlcGt);
										$("#gmlcssn").val(response.value.GmlcSsn);
										$("#hlrssn").val(response.value.HlrSsn);
										$("#mscssn").val(response.value.MscSsn);
										$("#maxmapv").val(response.value.MaxMapVersion);
																				
									}],
									error: function(value) {
										errorUID = ("st" + new Date().getTime()).hashCode();
										createStackTrace(errorUID, value.stacktrace);
										logToConsole("ERROR", value.error + ". (<a href=\"#" + errorUID + "-modal\" data-toggle=\"modal\">Full Stack Trace</a>)");										
									} 
								}
							);						

	    			});
					
					function applyServerSettings() {
						var formInvalid = false;
										
						
						var dialogtimeouterrmssg = $("#dialogtimeouterrmssg").val();
						if(dialogtimeouterrmssg.trim() == "") {
			    			$("#div-dialogtimeouterrmssg").addClass("error");					    			
			    			formInvalid = true;
			    		} else if($("#div-dialogtimeouterrmssg").hasClass("error")) {
			    			$("#div-dialogtimeouterrmssg").removeClass("error");		
			    		}
						
						var dialogtimeout = $("#dialogtimeout").val();
						if(dialogtimeout.trim() == "") {
			    			$("#div-dialogtimeout").addClass("error");					    			
			    			formInvalid = true;
			    		} else if($("#div-dialogtimeout").hasClass("error")) {
			    			$("#div-dialogtimeout").removeClass("error");		
			    		}
						
						var maxactivitycount = $("#maxactivitycount").val();
						if(maxactivitycount.trim() == "") {
			    			$("#div-maxactivitycount").addClass("error");					    			
			    			formInvalid = true;
			    		} else if($("#div-maxactivitycount").hasClass("error")) {
			    			$("#div-maxactivitycount").removeClass("error");		
			    		}
						
						var servererrmssg = $("#servererrmssg").val();
						if(servererrmssg.trim() == "") {
			    			$("#div-servererrmssg").addClass("error");					    			
			    			formInvalid = true;
			    		} else if($("#div-servererrmssg").hasClass("error")) {
			    			$("#div-servererrmssg").removeClass("error");		
			    		}

						var serveroverloadedmessage = $("#serveroverloadedmessage").val();
						if(serveroverloadedmessage.trim() == "") {
			    			$("#div-serveroverloadedmessage").addClass("error");					    			
			    			formInvalid = true;
			    		} else if($("#div-serveroverloadedmessage").hasClass("error")) {
			    			$("#div-serveroverloadedmessage").removeClass("error");		
			    		}
						
											
						var gmlcgt = $("#gmlcgt").val();
						if(gmlcgt.trim() == "") {
			    			$("#div-gmlcgt").addClass("error");					    			
			    			formInvalid = true;
			    		} else if($("#div-gmlcgt").hasClass("error")) {
			    			$("#div-gmlcgt").removeClass("error");		
			    		}
						
						
																		
						var gmlcssn = $("#gmlcssn").val();
						if(gmlcssn.trim() == "") {
			    			$("#div-gmlcssn").addClass("error");					    			
			    			formInvalid = true;
			    		} else if($("#div-gmlcssn").hasClass("error")) {
			    			$("#div-gmlcssn").removeClass("error");		
			    		}		
						
						var hlrssn = $("#hlrssn").val();
						if(hlrssn.trim() == "") {
			    			$("#div-hlrssn").addClass("error");					    			
			    			formInvalid = true;
			    		} else if($("#div-hlrssn").hasClass("error")) {
			    			$("#div-hlrssn").removeClass("error");		
			    		}	
						
						var mscssn = $("#mscssn").val();
						if(mscssn.trim() == "") {
			    			$("#div-mscssn").addClass("error");					    			
			    			formInvalid = true;
			    		} else if($("#div-mscssn").hasClass("error")) {
			    			$("#div-mscssn").removeClass("error");		
			    		}
						
						var maxmapv = $("#maxmapv").val();
						if(maxmapv.trim() == "") {
			    			$("#div-maxmapv").addClass("error");					    			
			    			formInvalid = true;
			    		} else if($("#div-maxmapv").hasClass("error")) {
			    			$("#div-maxmapv").removeClass("error");		
			    		}
						
						
						if(formInvalid) {
							$("#login-settings-error").show();
							logToConsole("ERROR", "Some Fields are not correctly filled out, please double check the settings !");
							return false;
						} else {
							$("#login-settings-error").hide();
						}
						
						mbeanSearch="org.mobicents.gmlc:name=GmlcPropertiesManagement";
						
						
						
						jolokia.request(
								[
									{ type: "write", mbean: mbeanSearch, attribute: "DialogTimeoutErrorMessage", value: dialogtimeouterrmssg },
									{ type: "write", mbean: mbeanSearch, attribute: "DialogTimeout", value: dialogtimeout },
									{ type: "write", mbean: mbeanSearch, attribute: "MaxActivityCount", value: maxactivitycount },
									{ type: "write", mbean: mbeanSearch, attribute: "ServerErrorMessage", value: servererrmssg },
									{ type: "write", mbean: mbeanSearch, attribute: "ServerOverloadedMessage", value: serveroverloadedmessage },
									{ type: "write", mbean: mbeanSearch, attribute: "GmlcSsn", value: gmlcssn },
									{ type: "write", mbean: mbeanSearch, attribute: "HlrSsn", value: hlrssn },
									{ type: "write", mbean: mbeanSearch, attribute: "MscSsn", value: mscssn },
									{ type: "write", mbean: mbeanSearch, attribute: "MaxMapVersion", value: maxmapv }
								],
								{
									success: function(response) {
										logToConsole("INFO", "GMLC Properties successfully updated.");
									},
									error: function(response) {
										errorUID = ("st" + new Date().getTime()).hashCode();
										createStackTrace(errorUID, response.stacktrace);
										logToConsole("ERROR", value.error + ". (<a href=\"#" + errorUID + "-modal\" data-toggle=\"modal\">Full Stack Trace</a>)");										
									} 
								}
							);	
						
						
						if(gtinitext != "0"){
							jolokia.execute(mbeanSearch,"setGmlcGt", gtinitext,gmlcgt, 
									{
										success: function(value) {
											$("#gtinisel").empty();
											updateSs7Properties();
											logToConsole("INFO", "GMLC SS7 settings successfully updated.");
										},
										error: function(value){
											errorUID = ("st" + new Date().getTime()).hashCode();
											createStackTrace(errorUID, value.stacktrace);
											logToConsole("ERROR", value.error + ". (<a href=\"#" + errorUID + "-modal\" data-toggle=\"modal\">Full Stack Trace</a>)");
										}					
									});	
							} else {
								
								
								jolokia.request(
										[							
											{ type: "write", mbean: mbeanSearch, attribute: "GmlcGt", value: gmlcdgt },
										],
										{
											success: function(response) {
												logToConsole("INFO", "GMLC SS7 settings successfully updated.");
											},
											error: function(response) {
												logToConsole("ERROR", "Failure trying to communicate with the Restcomm GMLC. Please try again later.");
											} 
										}
								);
							}						
					}
					
					function gtInSelChange(){
						var gtinisel = document.getElementById("gtinisel");
						var gtinitext = document.getElementById("gtinitext");
						var gmlcgt = document.getElementById("gmlcgt");
						
						gtinitext.value = gtinisel.options[gtinisel.selectedIndex].text;
						gmlcgt.value = gtinisel.options[gtinisel.selectedIndex].value;
					}					
					</script>
